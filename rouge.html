
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Instance du SystÃ¨me â€“ Fiche & Recrutement</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg: #05070b;
      --bg-alt: #0b0f17;
      --accent: #ff4e6a;
      --accent-soft: rgba(255, 78, 106, 0.12);
      --text: #f5f5f7;
      --muted: #8b90a4;
      --border: #252a3a;
      --ok: #3dd68c;
      --warn: #ffb347;
      --danger: #ff4e6a;
      --radius-lg: 18px;
      --radius-xl: 24px;
      --shadow-soft: 0 22px 60px rgba(0, 0, 0, 0.6);
      --transition-fast: 0.18s ease-out;
      --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
                   "Segoe UI", Roboto, sans-serif;
      --mono: "SF Mono", Menlo, Consolas, monospace;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: var(--font-sans);
      background: radial-gradient(circle at top left, #15192a 0, #05070b 45%, #000 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 24px;
    }

    .app {
      width: 100%;
      max-width: 1200px;
      background: linear-gradient(135deg, rgba(255,255,255,0.04), rgba(0,0,0,0.7));
      border-radius: 32px;
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: var(--shadow-soft);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      backdrop-filter: blur(16px);
    }

    header {
      padding: 18px 22px;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      display: flex;
      align-items: center;
      gap: 14px;
      background: radial-gradient(circle at top left, rgba(255,78,106,0.16), transparent 60%);
    }

    .logo {
      width: 32px;
      height: 32px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--accent);
      font-weight: 800;
      font-size: 18px;
      letter-spacing: 0.08em;
      box-shadow: 0 0 18px rgba(255,78,106,0.55);
      background: radial-gradient(circle, rgba(255,255,255,0.15), rgba(5,7,11,0.95));
    }

    .title-block {
      flex: 1;
    }

    .title-block h1 {
      margin: 0;
      font-size: 18px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .title-block h2 {
      margin: 2px 0 0;
      font-size: 22px;
      font-weight: 600;
    }

    .badge {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      border: 1px solid rgba(255,255,255,0.16);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: radial-gradient(circle, var(--ok), #04724d);
      box-shadow: 0 0 6px rgba(61,214,140,0.8);
    }

    main {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 18px;
      padding: 18px 18px 20px;
    }

    @media (max-width: 880px) {
      main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .panel {
      background: radial-gradient(circle at top, rgba(12,18,32,0.9), rgba(3,5,9,0.95));
      border-radius: var(--radius-xl);
      border: 1px solid var(--border);
      padding: 16px 16px 18px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(255,78,106,0.11), transparent 55%);
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .panel h3 {
      margin: 0;
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 8px;
      position: relative;
      z-index: 1;
    }

    .panel h3 span.icon {
      font-size: 17px;
    }

    .panel-inner {
      display: flex;
      flex-direction: column;
      gap: 12px;
      position: relative;
      z-index: 1;
    }

    .fieldset {
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255,255,255,0.06);
      padding: 10px 12px 12px;
      background: radial-gradient(circle at top left, rgba(255,255,255,0.02), rgba(0,0,0,0.8));
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .fieldset legend,
    .fieldset-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted);
    }

    label {
      font-size: 13px;
      display: block;
      margin-bottom: 2px;
      color: var(--muted);
    }

    input[type="text"],
    input[type="number"],
    textarea,
    select {
      width: 100%;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.15);
      background: rgba(2,4,9,0.9);
      color: var(--text);
      font-family: var(--font-sans);
      font-size: 13px;
      outline: none;
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast),
                  background var(--transition-fast), transform var(--transition-fast);
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(255,78,106,0.6);
      background: #050814;
      transform: translateY(-0.5px);
    }

    textarea {
      resize: vertical;
      min-height: 60px;
      max-height: 260px;
    }

    .inline-fields {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 8px;
    }

    .photo-zone {
      display: flex;
      gap: 12px;
      align-items: stretch;
      flex-wrap: wrap;
    }

    .photo-preview {
      width: 120px;
      height: 120px;
      border-radius: 20px;
      border: 1px dashed rgba(255,255,255,0.25);
      background: repeating-linear-gradient(
        -45deg,
        rgba(255,255,255,0.03),
        rgba(255,255,255,0.03) 4px,
        rgba(5,10,20,0.9) 4px,
        rgba(5,10,20,0.9) 8px
      );
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
    }

    .photo-preview span {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--muted);
      text-align: center;
      padding: 0 8px;
    }

    .photo-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: none;
    }

    .photo-preview.has-image img {
      display: block;
    }

    .photo-preview.has-image span {
      display: none;
    }

    .photo-input {
      flex: 1;
      min-width: 180px;
      font-size: 12px;
    }

    .photo-input input[type="file"] {
      width: 100%;
      font-size: 11px;
      color: var(--muted);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 11px;
    }

    .chip {
      padding: 3px 8px 4px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.02);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--muted);
    }

    .chip .dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 6px rgba(255,78,106,0.8);
    }

    .question-block {
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 8px 10px 10px;
      background: rgba(0,0,0,0.45);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .question-block p {
      margin: 0;
      font-size: 13px;
    }

    .answer-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 12px;
    }

    .answer-row label {
      margin: 0;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }

    .answer-row input[type="radio"] {
      accent-color: var(--accent);
    }

    .status-bar {
      border-radius: 999px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      padding: 4px 6px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--muted);
      font-family: var(--mono);
    }

    .status-bar-fill {
      flex: 1;
      height: 6px;
      border-radius: 999px;
      background: rgba(255,255,255,0.04);
      overflow: hidden;
      position: relative;
    }

    .status-bar-fill-inner {
      position: absolute;
      inset: 0;
      width: 0%;
      border-radius: inherit;
      background: linear-gradient(90deg, var(--danger), var(--warn), var(--ok));
      box-shadow: 0 0 8px rgba(255,78,106,0.7);
      transition: width 0.35s ease-out;
    }

    .status-pill {
      padding: 2px 8px 3px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .status-pill[data-tone="danger"] {
      border-color: rgba(255,78,106,0.7);
      color: var(--danger);
    }
    .status-pill[data-tone="warn"] {
      border-color: rgba(255,179,71,0.7);
      color: var(--warn);
    }
    .status-pill[data-tone="ok"] {
      border-color: rgba(61,214,140,0.7);
      color: var(--ok);
    }

    .export-area {
      border-radius: 14px;
      border: 1px dashed rgba(255,255,255,0.14);
      padding: 9px 10px 10px;
      background: rgba(0,0,0,0.5);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    button {
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      padding: 7px 14px;
      font-size: 12px;
      font-weight: 500;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      background: radial-gradient(circle at top left, var(--accent), #8c1c3a);
      color: #fff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 6px 22px rgba(0,0,0,0.7);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast),
                  background var(--transition-fast), opacity var(--transition-fast);
    }

    button.secondary {
      background: transparent;
      border-style: dashed;
      box-shadow: none;
      color: var(--muted);
    }

    button.small {
      padding: 5px 12px;
      font-size: 11px;
    }

    button span.icon {
      font-size: 13px;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 28px rgba(0,0,0,0.8);
      opacity: 0.98;
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 3px 14px rgba(0,0,0,0.85);
      opacity: 0.9;
    }

    .export-output {
      font-family: var(--mono);
      font-size: 11px;
      background: rgba(0,0,0,0.8);
      border-radius: 10px;
      padding: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--muted);
      max-height: 160px;
      overflow: auto;
      white-space: pre;
    }

    .helper-text {
      font-size: 11px;
      color: var(--muted);
    }

    details.rules {
      border-radius: 14px;
      border: 1px dashed rgba(255,255,255,0.2);
      padding: 7px 10px 9px;
      background: rgba(6,8,14,0.95);
      font-size: 11px;
      color: var(--muted);
      position: relative;
    }

    details.rules summary {
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-size: 10px;
      color: rgba(255,78,106,0.9);
      list-style: none;
    }

    details.rules summary::-webkit-details-marker {
      display: none;
    }

    details.rules ul {
      margin: 7px 0 0;
      padding-left: 16px;
    }

    footer {
      border-top: 1px solid rgba(255,255,255,0.04);
      padding: 9px 18px 10px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 11px;
      color: var(--muted);
    }

    .steps {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .step-pill {
      border-radius: 999px;
      padding: 3px 9px 4px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.6);
    }

    .hint {
      font-family: var(--mono);
      opacity: 0.7;
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo" title="Every. Agent. Runs. Loops.">E</div>
    <div class="title-block">
      <div class="badge">
        <span class="badge-dot"></span>
        <span>Instance active â€“ Jeu le plus culte du monde entier</span>
      </div>
      <h2>Interface du SystÃ¨me</h2>
      <h1>Fiche de personnage &amp; Test de recrutement</h1>
    </div>
    <button id="compute-btn" class="small" type="button">
      <span class="icon">â–¶</span> Ã‰valuer le profil
    </button>
  </header>

  <main>
    <!-- FICHE PERSONNAGE -->
    <section class="panel" aria-label="Fiche personnage">
      <h3><span class="icon">ðŸ§¬</span> Fiche dâ€™instance</h3>
      <div class="panel-inner">
        <div class="fieldset">
          <div class="inline-fields">
            <div>
              <label for="c-name">Nom civil</label>
              <input id="c-name" type="text" placeholder="Ton nom dans le monde gris">
            </div>
            <div>
              <label for="c-alias">Nom de code</label>
              <input id="c-alias" type="text" placeholder="Alias choisi par le SystÃ¨me">
            </div>
            <div>
              <label for="c-role">RÃ´le dans lâ€™organisation</label>
              <input id="c-role" type="text" placeholder="Ex : Cartographe de lâ€™absurde">
            </div>
          </div>
        </div>

        <div class="fieldset">
          <span class="fieldset-label">IdentitÃ© visuelle</span>
          <div class="photo-zone">
            <div class="photo-preview" id="photo-preview">
              <span>Photo de lâ€™instance<br>(clic Ã  droite)</span>
              <img id="photo-img" alt="AperÃ§u de la photo du personnage">
            </div>
            <div class="photo-input">
              <label for="c-photo">Photo (JPG/PNG) â€“ rien nâ€™est envoyÃ© nulle part</label>
              <input id="c-photo" type="file" accept="image/*">
              <p class="helper-text">
                Lâ€™image est chargÃ©e localement dans ton navigateur.  
                Tu peux embarquer ce fichier HTML et ton image ensemble sur une clÃ© USB.
              </p>
            </div>
          </div>
        </div>

        <div class="fieldset">
          <span class="fieldset-label">ParamÃ¨tres de caractÃ¨re</span>
          <div class="inline-fields">
            <div>
              <label for="c-alignment">Alignement face Ã  la dystopie</label>
              <select id="c-alignment">
                <option value="">â€” Choisir â€”</option>
                <option value="lucide">Lucide mais joueurÂ·se</option>
                <option value="sous-marin">Sous-marin dans le systÃ¨me</option>
                <option value="agitateur">AgitateurÂ·rice discretÂ·e</option>
                <option value="poete">PoÃ¨te du chaos organisÃ©</option>
              </select>
            </div>
            <div>
              <label for="c-age">Niveau dâ€™itÃ©ration (Ã¢ge)</label>
              <input id="c-age" type="number" min="0" max="120" placeholder="â€¦">
            </div>
          </div>
          <label for="c-skills">CompÃ©tences clefs</label>
          <textarea id="c-skills" placeholder="- Voir lâ€™absurde organisationnel
- RepÃ©rer les camÃ©ras (et les excuses)
- Transformer une rÃ©union inutile en mission secrÃ¨te"></textarea>

          <label for="c-flaws">Failles / limites assumÃ©es</label>
          <textarea id="c-flaws" placeholder="- Besoin rÃ©gulier de cafÃ©
- Allergie aux formulaires de 7 pages
- Tendance Ã  poser des questions qui dÃ©rangent"></textarea>
        </div>

        <div class="fieldset">
          <span class="fieldset-label">Signatures & traces</span>
          <label for="c-tagline">Phrase manifeste (slogan personnel)</label>
          <input id="c-tagline" type="text" placeholder="Ex : Â« Si tout est normal, câ€™est quâ€™on ne regarde pas au bon endroit. Â»">

          <label for="c-notes">Notes secrÃ¨tes Ã  S (facultatif)</label>
          <textarea id="c-notes" placeholder="Tu peux laisser ici un message Ã  S. 
Cette zone ne part nulle part tant que tu ne publies pas la page."></textarea>

          <div class="chip-row">
            <div class="chip">
              <span class="dot"></span>
              <span>ID instance : <span id="c-id">en attenteâ€¦</span></span>
            </div>
            <div class="chip">
              <span class="dot"></span>
              <span>Statut : en recrutement</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- TEST RECRUTEMENT -->
    <section class="panel" aria-label="Test de recrutement">
      <h3><span class="icon">ðŸ§ª</span> Test de recrutement interne</h3>
      <div class="panel-inner">
        <div class="fieldset">
          <span class="fieldset-label">Scan de compatibilitÃ©</span>

          <div class="question-block">
            <p>1. Tu rentres dans un bÃ¢timent public truffÃ© de camÃ©ras intelligentes. Tu te dis :</p>
            <div class="answer-row">
              <label><input type="radio" name="q1" value="0"> Â« Super, je serai en sÃ©curitÃ©. Â»</label>
              <label><input type="radio" name="q1" value="1"> Â« Qui stocke ces donnÃ©es, dÃ©jÃ  ? Â»</label>
              <label><input type="radio" name="q1" value="2"> Â« OÃ¹ est lâ€™angle mort le plus proche ? Â»</label>
            </div>
          </div>

          <div class="question-block">
            <p>2. On tâ€™invite Ã  une rÃ©union de 2 heures sans ordre du jour clair.</p>
            <div class="answer-row">
              <label><input type="radio" name="q2" value="0"> Tu acceptes, câ€™est la procÃ©dure.</label>
              <label><input type="radio" name="q2" value="1"> Tu demandes lâ€™objectif Ã©crit avant.</label>
              <label><input type="radio" name="q2" value="2"> Tu proposes un message asynchrone chiffrÃ© Ã  la place.</label>
            </div>
          </div>

          <div class="question-block">
            <p>3. UnÂ·e supÃ©rieurÂ·e te micro-manage au point de vouloir copier chaque e-mail.</p>
            <div class="answer-row">
              <label><input type="radio" name="q3" value="0"> Tu obÃ©is pour Â« Ã©viter les vagues Â».</label>
              <label><input type="radio" name="q3" value="1"> Tu nÃ©gocies des zones dâ€™autonomie.</label>
              <label><input type="radio" name="q3" value="2"> Tu montres que la confiance est plus efficace que le contrÃ´le.</label>
            </div>
          </div>

          <div class="question-block">
            <p>4. On te demande de produire un rapport inutile Â« parce quâ€™on a toujours fait comme Ã§a Â».</p>
            <div class="answer-row">
              <label><input type="radio" name="q4" value="0"> Tu le fais, mais tu souffres en silence.</label>
              <label><input type="radio" name="q4" value="1"> Tu proposes un indicateur plus utile.</label>
              <label><input type="radio" name="q4" value="2"> Tu automatise le rapport et tu documentes lâ€™absurditÃ©.</label>
            </div>
          </div>
        </div>

        <div class="status-bar">
          <span>Indice anti-dystopie</span>
          <div class="status-bar-fill">
            <div id="status-fill" class="status-bar-fill-inner"></div>
          </div>
          <span id="status-score">0%</span>
          <span id="status-pill" class="status-pill" data-tone="danger">incomplet</span>
        </div>

        <div class="export-area">
          <div class="btn-row">
            <button id="export-json-btn" type="button">
              <span class="icon">ðŸ’¾</span> Exporter en JSON
            </button>
            <button id="export-md-btn" type="button" class="secondary">
              <span class="icon">ðŸ“‹</span> GÃ©nÃ©rer rÃ©sumÃ© Markdown
            </button>
            <button id="copy-md-btn" type="button" class="secondary small">
              <span class="icon">â§‰</span> Copier le rÃ©sumÃ©
            </button>
          </div>
          <div class="helper-text">
            âžœ Utilise ces exports pour archiver ton personnage, partager avec ton cercle de confiance  
            ou reconstituer ton instance aprÃ¨s un Â« reset Â» du SystÃ¨me.
          </div>
          <div id="export-output" class="export-output" aria-label="Zone dâ€™export"></div>
        </div>

        <details class="rules">
          <summary>Meta-rÃ¨gles internes (Ã  ne surtout pas lire)</summary>
          <ul>
            <li>RÃ¨gle nÂ°1 : on ne parle jamais des rÃ¨gles.</li>
            <li>RÃ¨gle nÂ°2 : il nâ€™y a pas de rÃ¨gle.</li>
            <li>RÃ¨gle nÂ°3 : on sâ€™en fout pas mal.</li>
          </ul>
          <p>Indice sur la rÃ¨gle dâ€™or : tâ€™as rien compris.</p>
        </details>

        <!-- exigence : prÃ©sence explicite de <vide>vide</vide> -->
        <div style="display:none;">
          <vide>vide</vide>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="steps">
      <div class="step-pill">1. Sauvegarde ce fichier sous le nom <code>instance.html</code></div>
      <div class="step-pill">2. Modifie-le avec ton Ã©diteur prÃ©fÃ©rÃ© (fiche, style, missionsâ€¦)</div>
      <div class="step-pill">3. Quand tu es prÃªtÂ·e pour S : renomme-le en <code>index.html</code> et publie-le sur GitHub Pages</div>
    </div>
    <div class="hint">
      Toute personne est dÃ©jÃ  une instance. Le reste nâ€™est que synchronisation.
    </div>
  </footer>
</div>

<script>
(function () {
  // GÃ©nÃ¨re un identifiant d'instance pseudo-alÃ©atoire basÃ© sur le temps + un peu de bruit
  function generateInstanceId() {
    var base = Date.now().toString(36).toUpperCase();
    var rand = Math.floor(Math.random() * 46655).toString(36).toUpperCase().padStart(3, "0");
    return "S-" + base + "-" + rand;
  }

  var idEl = document.getElementById("c-id");
  idEl.textContent = generateInstanceId();

  // Gestion photo (local uniquement)
  var fileInput = document.getElementById("c-photo");
  var img = document.getElementById("photo-img");
  var preview = document.getElementById("photo-preview");

  fileInput.addEventListener("change", function (e) {
    var file = e.target.files && e.target.files[0];
    if (!file) return;
    if (!file.type.startsWith("image/")) {
      alert("Merci de choisir un fichier image.");
      return;
    }
    var reader = new FileReader();
    reader.onload = function (ev) {
      img.src = ev.target.result;
      preview.classList.add("has-image");
    };
    reader.readAsDataURL(file);
  });

  // Lecture des rÃ©ponses au test
  function getScore() {
    var total = 0;
    var maxPerQuestion = 2;
    var qCount = 4;
    for (var i = 1; i <= qCount; i++) {
      var checked = document.querySelector("input[name='q" + i + "']:checked");
      if (checked) {
        total += parseInt(checked.value, 10) || 0;
      }
    }
    var maxScore = qCount * maxPerQuestion;
    var percent = maxScore === 0 ? 0 : Math.round((total / maxScore) * 100);
    return percent;
  }

  var fill = document.getElementById("status-fill");
  var scoreEl = document.getElementById("status-score");
  var pill = document.getElementById("status-pill");

  function updateStatus() {
    var p = getScore();
    fill.style.width = p + "%";
    scoreEl.textContent = p + "%";

    if (p <= 30) {
      pill.textContent = "sous contrÃ´le du systÃ¨me";
      pill.dataset.tone = "danger";
    } else if (p <= 70) {
      pill.textContent = "ambiguÂ·e mais rÃ©cupÃ©rable";
      pill.dataset.tone = "warn";
    } else {
      pill.textContent = "recrutable â€“ ping S";
      pill.dataset.tone = "ok";
    }
  }

  document.getElementById("compute-btn").addEventListener("click", updateStatus);
  // Met Ã  jour Ã  chaque clic de rÃ©ponse
  document.querySelectorAll("input[type='radio']").forEach(function (el) {
    el.addEventListener("change", updateStatus);
  });

  // Collecte de la fiche + test
  function collectData() {
    function v(id) {
      var el = document.getElementById(id);
      return el ? el.value : "";
    }

    var answers = {};
    for (var i = 1; i <= 4; i++) {
      var checked = document.querySelector("input[name='q" + i + "']:checked");
      answers["q" + i] = checked ? checked.value : null;
    }

    var data = {
      meta: {
        instanceId: idEl.textContent,
        generatedAt: new Date().toISOString()
      },
      identity: {
        name: v("c-name"),
        alias: v("c-alias"),
        role: v("c-role"),
        alignment: v("c-alignment"),
        age: v("c-age")
      },
      profile: {
        skills: v("c-skills"),
        flaws: v("c-flaws"),
        tagline: v("c-tagline"),
        notesToS: v("c-notes")
      },
      recruitmentTest: {
        antiDystopiaScorePercent: getScore(),
        rawAnswers: answers
      }
    };
    return data;
  }

  // Export JSON
  var exportOutput = document.getElementById("export-output");
  document.getElementById("export-json-btn").addEventListener("click", function () {
    var data = collectData();
    var json = JSON.stringify(data, null, 2);
    exportOutput.textContent = json;

    var blob = new Blob([json], { type: "application/json" });
    var url = URL.createObjectURL(blob);
    var a = document.createElement("a");
    a.href = url;
    var alias = (data.identity.alias || "instance").replace(/\s+/g, "_");
    a.download = alias + "_instance.json";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  });

  // Export Markdown
  function buildMarkdown(data) {
    var md = [];
    md.push("# Fiche de personnage â€“ Instance du SystÃ¨me");
    md.push("");
    md.push("ID dâ€™instance : `" + data.meta.instanceId + "`");
    md.push("GÃ©nÃ©rÃ© le : " + data.meta.generatedAt);
    md.push("");
    md.push("## IdentitÃ©");
    md.push("- Nom civil : " + (data.identity.name || "_non renseignÃ©_"));
    md.push("- Nom de code : **" + (data.identity.alias || "N/D") + "**");
    md.push("- RÃ´le : " + (data.identity.role || "_non renseignÃ©_"));
    md.push("- Alignement : " + (data.identity.alignment || "_non renseignÃ©_"));
    md.push("- Iteration (Ã¢ge) : " + (data.identity.age || "_non renseignÃ©_"));
    md.push("");
    md.push("## CompÃ©tences");
    md.push(data.profile.skills || "_Ã  dÃ©finir_");
    md.push("");
    md.push("## Failles / limites");
    md.push(data.profile.flaws || "_aucune avouÃ©e (suspicion de narration mensongÃ¨re)_");
    md.push("");
    md.push("## Manifeste personnel");
    md.push(data.profile.tagline || "_vide_");
    md.push("");
    md.push("## Notes Ã  S");
    md.push(data.profile.notesToS || "_(rien pour lâ€™instant)_");
    md.push("");
    md.push("## Test de recrutement");
    md.push("- Score anti-dystopie : **" + data.recruitmentTest.antiDystopiaScorePercent + "%**");
    md.push("- RÃ©ponses brutes : " + JSON.stringify(data.recruitmentTest.rawAnswers));
    md.push("");
    md.push("_Meta-rÃ¨gles : on ne parle jamais des rÃ¨gles. Il nâ€™y a pas de rÃ¨gle. On sâ€™en fout pas mal._");
    return md.join("\n");
  }

  document.getElementById("export-md-btn").addEventListener("click", function () {
    var data = collectData();
    var md = buildMarkdown(data);
    exportOutput.textContent = md;
  });

  // Copier Markdown
  document.getElementById("copy-md-btn").addEventListener("click", function () {
    var text = exportOutput.textContent || "";
    if (!text) {
      var data = collectData();
      text = buildMarkdown(data);
      exportOutput.textContent = text;
    }
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text).then(function () {
        alert("RÃ©sumÃ© copiÃ© dans le presse-papiers.");
      }, function () {
        alert("Impossible de copier automatiquement, sÃ©lectionne et copie Ã  la main.");
      });
    } else {
      alert("Copie automatique non supportÃ©e, sÃ©lectionne la zone et copie Ã  la main.");
    }
  });

  // Calcul initial
  updateStatus();
})();
</script>
</body>
</html>
